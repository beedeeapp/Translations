name: Create PR from issue

on:
  issues:
    types: [opened, edited]
  # Allows the action to be triggered manually
  workflow_dispatch:

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: View the github context
        run: echo "$GITHUB_CONTEXT"
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
      - name: Create new branch
        run: |
          npm install
          node scripts/updateTranslation.js '${{ github.event_path }}'
      - name: Create pull request
        id: cpr
        uses: peter-evans/create-pull-request@v7
        with:
          title: Translation updates
          body: |
            Auto-generated for ${{ github.event.issue.html_url }}.
      - name: Check outputs
        if: ${{ steps.cpr.outputs.pull-request-number }}
        run: gh issue comment "$NUMBER" --body "$BODY"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          NUMBER: ${{ github.event.issue.number }}
          BODY: >
            A PR has been automatically created for this ticket: ${{ steps.cpr.outputs.pull-request-url }}

